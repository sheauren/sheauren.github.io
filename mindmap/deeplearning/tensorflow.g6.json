{
    "id": "root",
    "isroot": true,
    "title": "tensorflow",
    "collapsed": false,
    "children": [
        {
            "id": "line_0",
            "title": "python",
            "background-color": "#fff",
            "collapsed": false,
            "children": [
                {
                    "id": "line_1",
                    "title": "conda",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_2",
                            "title": "tensorflow",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_3",
                            "title": "tensorflow-gpu",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                },
                {
                    "id": "line_4",
                    "title": "pip",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_5",
                            "title": "tensorflow",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_6",
                            "title": "numpy",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_7",
                            "title": "cv2",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_8",
                            "title": "Pillow",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_9",
                            "title": "matplotlib",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                }
            ]
        },
        {
            "id": "line_10",
            "title": "loss_function",
            "background-color": "#fff",
            "collapsed": false,
            "children": [
                {
                    "id": "line_11",
                    "title": "sparse_categorical_crossentropy",
                    "background-color": "#e3aba7",
                    "collapsed": false
                },
                {
                    "id": "line_12",
                    "title": "mean_squared_error:mse",
                    "background-color": "#e3aba7",
                    "collapsed": false
                }
            ]
        },
        {
            "id": "line_13",
            "title": "optimizer",
            "background-color": "#fff",
            "collapsed": false,
            "children": [
                {
                    "id": "line_14",
                    "title": "SGDOptimizer",
                    "background-color": "#e3aba7",
                    "collapsed": false
                },
                {
                    "id": "line_15",
                    "title": "AdamOptimizer",
                    "background-color": "#e3aba7",
                    "collapsed": false
                },
                {
                    "id": "line_16",
                    "title": "RMSPropOptimizer",
                    "background-color": "#e3aba7",
                    "collapsed": false
                }
            ]
        },
        {
            "id": "line_17",
            "title": "metrics",
            "background-color": "#fff",
            "collapsed": false,
            "children": [
                {
                    "id": "line_18",
                    "title": "accuracy",
                    "background-color": "#e3aba7",
                    "collapsed": false
                },
                {
                    "id": "line_19",
                    "title": "mean_absolute_error:mae",
                    "background-color": "#e3aba7",
                    "collapsed": false
                }
            ]
        },
        {
            "id": "line_20",
            "title": "callbacks",
            "background-color": "#fff",
            "collapsed": false,
            "children": [
                {
                    "id": "line_21",
                    "title": "EarlyStopping",
                    "background-color": "#e3aba7",
                    "collapsed": false
                },
                {
                    "id": "line_22",
                    "title": "ModelCheckpoint",
                    "background-color": "#e3aba7",
                    "collapsed": false
                },
                {
                    "id": "line_23",
                    "title": "class PrintDot(keras.callbacks.Callback):",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_24",
                            "title": "def on_epoch_end(self,epoch,logs):",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_25",
                                    "title": "if epoch % 100 == 0: print('')",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_26",
                                    "title": "print('.', end='')",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "id": "line_27",
            "title": "layer",
            "background-color": "#fff",
            "collapsed": false,
            "children": [
                {
                    "id": "line_28",
                    "title": "Dense",
                    "background-color": "#e3aba7",
                    "collapsed": false
                },
                {
                    "id": "line_29",
                    "title": "Conv2D",
                    "background-color": "#e3aba7",
                    "collapsed": false
                },
                {
                    "id": "line_30",
                    "title": "LSTM",
                    "background-color": "#e3aba7",
                    "collapsed": false
                },
                {
                    "id": "line_31",
                    "title": "BatchNormalized",
                    "background-color": "#e3aba7",
                    "collapsed": false
                },
                {
                    "id": "line_32",
                    "title": "Dropout",
                    "background-color": "#e3aba7",
                    "collapsed": false
                },
                {
                    "id": "line_33",
                    "title": "Custom Layer",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_34",
                            "title": "class MyDenseLayer(tf.keras.layers.Layer):",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_35",
                                    "title": "def __init__(self, num_outputs):",
                                    "background-color": "#0fbdff",
                                    "collapsed": true,
                                    "children": [
                                        {
                                            "id": "line_36",
                                            "title": "super(MyDenseLayer, self).__init__()",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_37",
                                            "title": "self.num_outputs = num_outputs",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        }
                                    ]
                                },
                                {
                                    "id": "line_38",
                                    "title": "def build(self, input_shape):",
                                    "background-color": "#0fbdff",
                                    "collapsed": true,
                                    "children": [
                                        {
                                            "id": "line_39",
                                            "title": "self.kernel = self.add_variable(\"kernel\",",
                                            "background-color": "#e3aba7",
                                            "collapsed": true,
                                            "children": [
                                                {
                                                    "id": "line_40",
                                                    "title": "shape=[input_shape[-1].value,",
                                                    "background-color": "#d41dea",
                                                    "collapsed": true
                                                },
                                                {
                                                    "id": "line_41",
                                                    "title": "self.num_outputs])",
                                                    "background-color": "#d41dea",
                                                    "collapsed": true
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "id": "line_42",
                                    "title": "def call(self, input):",
                                    "background-color": "#0fbdff",
                                    "collapsed": true,
                                    "children": [
                                        {
                                            "id": "line_43",
                                            "title": "return tf.matmul(input, self.kernel)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "id": "line_44",
                            "title": "layer = MyDenseLayer(10)",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                },
                {
                    "id": "line_45",
                    "title": "Composing Layer",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_46",
                            "title": "class ResnetIdentityBlock(tf.keras.Model):",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_47",
                                    "title": "def __init__(self, kernel_size, filters):",
                                    "background-color": "#0fbdff",
                                    "collapsed": true,
                                    "children": [
                                        {
                                            "id": "line_48",
                                            "title": "super(ResnetIdentityBlock, self).__init__(name='')",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_49",
                                            "title": "filters1, filters2, filters3 = filters",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_50",
                                            "title": "self.conv2a = tf.keras.layers.Conv2D(filters1, (1, 1))",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_51",
                                            "title": "self.bn2a = tf.keras.layers.BatchNormalization()",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_52",
                                            "title": "self.conv2b = tf.keras.layers.Conv2D(filters2, kernel_size, padding='same')",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_53",
                                            "title": "self.bn2b = tf.keras.layers.BatchNormalization()",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_54",
                                            "title": "self.conv2c = tf.keras.layers.Conv2D(filters3, (1, 1))",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_55",
                                            "title": "self.bn2c = tf.keras.layers.BatchNormalization()",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        }
                                    ]
                                },
                                {
                                    "id": "line_56",
                                    "title": "def call(self, input_tensor, training=False):",
                                    "background-color": "#0fbdff",
                                    "collapsed": true,
                                    "children": [
                                        {
                                            "id": "line_57",
                                            "title": "x = self.conv2a(input_tensor)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_58",
                                            "title": "x = self.bn2a(x, training=training)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_59",
                                            "title": "x = tf.nn.relu(x)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_60",
                                            "title": "x = self.conv2b(x)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_61",
                                            "title": "x = self.bn2b(x, training=training)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_62",
                                            "title": "x = tf.nn.relu(x)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_63",
                                            "title": "x = self.conv2c(x)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_64",
                                            "title": "x = self.bn2c(x, training=training)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_65",
                                            "title": "x += input_tensor",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_66",
                                            "title": "return tf.nn.relu(x)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "id": "line_67",
                            "title": "block = ResnetIdentityBlock(1, [1, 2, 3])",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                }
            ]
        },
        {
            "id": "line_68",
            "title": "overfit/underfit prevent",
            "background-color": "#fff",
            "collapsed": false,
            "children": [
                {
                    "id": "line_69",
                    "title": "overfit",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_70",
                            "title": "DropOut",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_71",
                            "title": "BatchNormalized",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_72",
                            "title": "Weight Normalized",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_73",
                            "title": "Data Argumentation",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                },
                {
                    "id": "line_74",
                    "title": "underfit",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_75",
                            "title": "more epochs",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                }
            ]
        },
        {
            "id": "line_76",
            "title": "dataset",
            "background-color": "#fff",
            "collapsed": false,
            "children": [
                {
                    "id": "line_77",
                    "title": "studing dataset",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_78",
                            "title": "train_x,train_y=tf.keras.dataset.fashion_mist.load_data()",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_79",
                            "title": "train_x,train_y=tf.keras.dataset.imdb.load_data()",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                },
                {
                    "id": "line_80",
                    "title": "custom dataset",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_81",
                            "title": "tf.data.Dataset.from_tensor_slices()",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                },
                {
                    "id": "line_82",
                    "title": "transformations",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_83",
                            "title": "batch",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_84",
                            "title": "map",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_85",
                            "title": "shuffle",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                }
            ]
        },
        {
            "id": "line_86",
            "title": "save/load weight",
            "background-color": "#fff",
            "collapsed": false,
            "children": [
                {
                    "id": "line_87",
                    "title": "save",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_88",
                            "title": "all training info",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_89",
                            "title": "h5 file",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                },
                {
                    "id": "line_90",
                    "title": "load_model",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_91",
                            "title": "h5 file",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                },
                {
                    "id": "line_92",
                    "title": "save_weights",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_93",
                            "title": "only weight data",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_94",
                            "title": "ckpt-checkpoint",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_95",
                            "title": "weight",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_96",
                                    "title": "file",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_97",
                                    "title": "weight file",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_98",
                                    "title": "tflite for deploy",
                                    "background-color": "#0fbdff",
                                    "collapsed": true,
                                    "children": [
                                        {
                                            "id": "line_99",
                                            "title": "convert form weight/h5",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "id": "line_100",
                    "title": "load_weights",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_101",
                            "title": "ckpt",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_102",
                            "title": "h5",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_103",
                            "title": "weight",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                },
                {
                    "id": "line_104",
                    "title": "load pretrain model",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_105",
                            "title": "tf.keras.Application.MobileNetV2",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_106",
                            "title": "tf.keras.Application.ResNet152V2",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                }
            ]
        },
        {
            "id": "line_107",
            "title": "enable_eager_execution",
            "background-color": "#fff",
            "collapsed": false,
            "children": [
                {
                    "id": "line_108",
                    "title": "tf.enable_eager_execution()",
                    "background-color": "#e3aba7",
                    "collapsed": false
                },
                {
                    "id": "line_109",
                    "title": "gradient function",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_110",
                            "title": "tf.contrib.eager.gradients_function(f)",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                },
                {
                    "id": "line_111",
                    "title": "gradient tape",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_112",
                            "title": "with tf.GradientTape() as tape:",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_113",
                                    "title": "pred = model(input_data), training=True)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_114",
                                    "title": "loss = loss_func(pred,target)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                }
                            ]
                        },
                        {
                            "id": "line_115",
                            "title": "gradients = tape.gradient(loss,model.trainable_variables)",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_116",
                            "title": "optimizer.apply_gradients(zip(gradients, model.trainable_variables))",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                }
            ]
        },
        {
            "id": "line_117",
            "title": "gpu",
            "background-color": "#fff",
            "collapsed": false,
            "children": [
                {
                    "id": "line_118",
                    "title": "nvida graphic card",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_119",
                            "title": "cuda version",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_120",
                            "title": "cudnn version",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_121",
                            "title": "tensorflow-gpu in conda",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_122",
                            "title": "tensorflow-gpu in tf1.x",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                }
            ]
        },
        {
            "id": "line_123",
            "title": "train_example:iris",
            "background-color": "#fff",
            "collapsed": false,
            "children": [
                {
                    "id": "line_124",
                    "title": "dataset",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_125",
                            "title": "train_dataset_url = \"http://download.tensorflow.org/data/iris_training.csv\"",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_126",
                            "title": "train_dataset_fp = tf.keras.utils.get_file(fname=os.path.basename(train_dataset_url),origin=train_dataset_url)",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_127",
                            "title": "column_names : ['sepal_length', 'sepal_width', 'petal_length', 'petal_width','species']",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_128",
                            "title": "train_dataset = tf.contrib.data.make_csv_dataset(",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_129",
                                    "title": "train_dataset_fp,",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_130",
                                    "title": "batch_size,",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_131",
                                    "title": "column_names=column_names ,",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_132",
                                    "title": "label_name=label_name,",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_133",
                                    "title": "num_epochs=1)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                }
                            ]
                        },
                        {
                            "id": "line_134",
                            "title": "train_x",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_135",
                                    "title": "(120,4)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_136",
                                    "title": "Features: ['sepal_length', 'sepal_width', 'petal_length', 'petal_width']",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                }
                            ]
                        },
                        {
                            "id": "line_137",
                            "title": "train_y",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_138",
                                    "title": "(120,1)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_139",
                                    "title": "Label: species",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                }
                            ]
                        }
                    ]
                },
                {
                    "id": "line_140",
                    "title": "model",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_141",
                            "title": "model = tf.keras.Sequential([",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_142",
                            "title": "tf.keras.layers.Dense(10, activation=tf.nn.relu, input_shape=(4,)),  # input shape required",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_143",
                            "title": "tf.keras.layers.Dense(10, activation=tf.nn.relu),",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_144",
                            "title": "tf.keras.layers.Dense(3)])",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                },
                {
                    "id": "line_145",
                    "title": "Using the model",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_146",
                            "title": "predictions = model(features)",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_147",
                            "title": "predictions=tf.nn.softmax(predictions[:,:],axis=1)",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_148",
                            "title": "predictions=tf.argmax(predictions, axis=1)",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                },
                {
                    "id": "line_149",
                    "title": "loss",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_150",
                            "title": "def loss(model, x, y):",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_151",
                                    "title": "y_ = model(x)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_152",
                                    "title": "return tf.losses.sparse_softmax_cross_entropy(labels=y, logits=y_)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                }
                            ]
                        }
                    ]
                },
                {
                    "id": "line_153",
                    "title": "gradient decent",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_154",
                            "title": "def grad(model, inputs, targets):",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_155",
                                    "title": "with tf.GradientTape() as tape:",
                                    "background-color": "#0fbdff",
                                    "collapsed": true,
                                    "children": [
                                        {
                                            "id": "line_156",
                                            "title": "loss_value = loss(model, inputs, targets)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        }
                                    ]
                                },
                                {
                                    "id": "line_157",
                                    "title": "return loss_value, tape.gradient(loss_value, model.trainable_variables)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                }
                            ]
                        }
                    ]
                },
                {
                    "id": "line_158",
                    "title": "optimizer",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_159",
                            "title": "optimizer = tf.train.GradientDescentOptimizer(learning_rate=0.01)",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_160",
                            "title": "global_step = tf.train.get_or_create_global_step()",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_161",
                            "title": "optimizer.apply_gradients(zip(grads, model.variables), global_step)",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        }
                    ]
                },
                {
                    "id": "line_162",
                    "title": "epochs",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_163",
                            "title": "train_loss_results = []",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_164",
                            "title": "train_accuracy_results = []",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_165",
                            "title": "num_epochs = 201",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_166",
                            "title": "for epoch in range(num_epochs):",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_167",
                                    "title": "epoch_loss_avg = tfe.metrics.Mean()",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_168",
                                    "title": "epoch_accuracy = tfe.metrics.Accuracy()",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_169",
                                    "title": "for x, y in train_dataset:",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_170",
                                    "title": "loss_value, grads = grad(model, x, y)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_171",
                                    "title": "optimizer.apply_gradients(zip(grads, model.variables),global_step)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_172",
                                    "title": "epoch_loss_avg(loss_value)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_173",
                                    "title": "epoch_accuracy(tf.argmax(model(x), axis=1, output_type=tf.int32), y)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                }
                            ]
                        },
                        {
                            "id": "line_174",
                            "title": "train_loss_results.append(epoch_loss_avg.result())",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_175",
                            "title": "train_accuracy_results.append(epoch_accuracy.result())",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_176",
                            "title": "if epoch % 50 == 0:",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_177",
                                    "title": "print(\"Epoch {:03d}: Loss: {:.3f}, Accuracy: {:.3%}\".format(epoch,",
                                    "background-color": "#0fbdff",
                                    "collapsed": true,
                                    "children": [
                                        {
                                            "id": "line_178",
                                            "title": "epoch_loss_avg.result(),",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_179",
                                            "title": "epoch_accuracy.result()))",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "id": "line_180",
                    "title": "test",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_181",
                            "title": "dataset",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_182",
                                    "title": "test_url = \"http://download.tensorflow.org/data/iris_test.csv\"",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_183",
                                    "title": "test_fp = tf.keras.utils.get_file(fname=os.path.basename(test_url),origin=test_url)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_184",
                                    "title": "test_dataset = tf.contrib.data.make_csv_dataset(",
                                    "background-color": "#0fbdff",
                                    "collapsed": true,
                                    "children": [
                                        {
                                            "id": "line_185",
                                            "title": "train_dataset_fp,",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_186",
                                            "title": "batch_size,",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_187",
                                            "title": "column_names=column_names,",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_188",
                                            "title": "label_name='species',",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_189",
                                            "title": "num_epochs=1,",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_190",
                                            "title": "shuffle=False)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        }
                                    ]
                                },
                                {
                                    "id": "line_191",
                                    "title": "test_dataset = test_dataset.map(pack_features_vector)",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                }
                            ]
                        },
                        {
                            "id": "line_192",
                            "title": "testing",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_193",
                                    "title": "test_accuracy = tfe.metrics.Accuracy()",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_194",
                                    "title": "for (x, y) in test_dataset:",
                                    "background-color": "#0fbdff",
                                    "collapsed": true,
                                    "children": [
                                        {
                                            "id": "line_195",
                                            "title": "logits = model(x)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_196",
                                            "title": "prediction = tf.argmax(logits, axis=1, output_type=tf.int32)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        },
                                        {
                                            "id": "line_197",
                                            "title": "test_accuracy(prediction, y)",
                                            "background-color": "#e3aba7",
                                            "collapsed": true
                                        }
                                    ]
                                },
                                {
                                    "id": "line_198",
                                    "title": "print(\"Test set accuracy: {:.3%}\".format(test_accuracy.result()))",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                }
                            ]
                        }
                    ]
                },
                {
                    "id": "line_199",
                    "title": "predict",
                    "background-color": "#e3aba7",
                    "collapsed": false,
                    "children": [
                        {
                            "id": "line_200",
                            "title": "predict_dataset = tf.convert_to_tensor([",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_201",
                                    "title": "[5.1, 3.3, 1.7, 0.5,],",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_202",
                                    "title": "[5.9, 3.0, 4.2, 1.5,],",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_203",
                                    "title": "[6.9, 3.1, 5.4, 2.1]",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                }
                            ]
                        },
                        {
                            "id": "line_204",
                            "title": "])",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_205",
                            "title": "predictions = model(predict_dataset)",
                            "background-color": "#e82ad2",
                            "collapsed": true
                        },
                        {
                            "id": "line_206",
                            "title": "for i, logits in enumerate(predictions):",
                            "background-color": "#e82ad2",
                            "collapsed": true,
                            "children": [
                                {
                                    "id": "line_207",
                                    "title": "class_idx = tf.argmax(logits).numpy()",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_208",
                                    "title": "p = tf.nn.softmax(logits)[class_idx]",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_209",
                                    "title": "name = class_names[class_idx]",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                },
                                {
                                    "id": "line_210",
                                    "title": "print(\"Example {} prediction: {} ({:4.1f}%)\".format(i, name, 100*p))",
                                    "background-color": "#0fbdff",
                                    "collapsed": true
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}